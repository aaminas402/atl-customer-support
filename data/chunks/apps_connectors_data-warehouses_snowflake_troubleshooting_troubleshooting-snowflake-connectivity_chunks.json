[
  {
    "content": "Troubleshooting Snowflake connectivity | Atlan Documentation\nSkip to main content\nOn this page\nHow to debug test authentication and preflight check errors?\nâ\nMissing warehouse grants\nThe user doesnât have USAGE and OPERATE grants on a warehouse.\nGrant warehouse access to the role\n:\nGRANT\nOPERATE\n,\nUSAGE\nON\nWAREHOUSE\n\"<warehouse>\"\nTO\nROLE atlan_user_role\n;\nThen, ensure that you\ngrant the role to the new user\n:\nGRANT\nROLE atlan_user_role\nTO\nUSER\natlan_user\n;\nMissing authorized access to SNOWFLAKE.ACCOUNT_USAGE schema\nThe user doesnât have authorized access to the SNOWFLAKE.ACCOUNT_USAGE database\nReach out to your account admin to\ngrant imported privileges\non the\nSnowflake\ndatabase to the role:\nUSE\nROLE ACCOUNTADMIN\n;\nGRANT\nIMPORTED\nPRIVILEGES\nON\nDATABASE\nSNOWFLAKE\nTO\nROLE atlan_user_role\n;\nIf\nusing a copied database\n, you'll need to grant the following permissions:\nGRANT\nUSAGE\nON\nDATABASE\n\"<copied-database>\"\nTO\nROLE atlan_user_role\n;\nGRANT\nUSAGE\nON\nSCHEMA\n\"<copied-schema>\"\nIN\nDATABASE\n\"<copied-database>\"\nTO\nROLE atlan_user_role\n;\nGRANT\nREFERENCES\nON\nALL\nVIEWS\nIN\nDATABASE\n\"<copied-database>\"\nTO\nROLE atlan_user_role\n;\nMissing usage grants on databases and/or schemas",
    "metadata": {
      "source_url": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.html",
      "source_type": "docs",
      "file": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.json",
      "chunk_id": 0
    }
  },
  {
    "content": "IN\nDATABASE\n\"<copied-database>\"\nTO\nROLE atlan_user_role\n;\nGRANT\nREFERENCES\nON\nALL\nVIEWS\nIN\nDATABASE\n\"<copied-database>\"\nTO\nROLE atlan_user_role\n;\nMissing usage grants on databases and/or schemas\nThe user doesn't have usage grants to the databases ` $missingDatabases ` and schemas ` $missingSchemas\nGrant\nmissing permissions listed here\nfor information schema extraction method.\nAtlan IP not allowlisted\nAtlan's current location or network isn't recognized by Snowflake's security settings. This can happen if Atlan's IP address isn't on the list of allowed addresses in Snowflake's network policies.\nIf you are using the IP allowlist in your Snowflake instance, you must add the\nAtlan IP to the allowlist\n. Contact\nAtlan support\nto obtain Atlan's IP addresses.\nIncorrect credentials\nThe username or the password provided to connect to the Snowflake account is incorrect.\nSign into the Snowflake account for the specified host and verify that the username and password are correct.\nYou can also create a new user, if required, by following the steps\nhere\n.\nMissing or unauthorized role",
    "metadata": {
      "source_url": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.html",
      "source_type": "docs",
      "file": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.json",
      "chunk_id": 1
    }
  },
  {
    "content": "You can also create a new user, if required, by following the steps\nhere\n.\nMissing or unauthorized role\nThe role specified in your connection configuration doesn't exist in Snowflake or your user account doesn't have grant to use this role.\nIf the role does not exist or is missing the required grants,\ncreate a role\nand then\ngrant the role to the user\n.\nUser account locked\nThe user account you're using to connect to Snowflake has been locked temporarily because of multiple incorrect login attempts.\nWait for the user account to unlock or create a different user account to continue.\nMissing or unauthorized warehouse\nThe warehouse specified in your connection configuration doesn't exist in Snowflake or your user account doesn't have grant to use this warehouse.\nEnsure that the warehouse name is configured correctly.\nUpdate the warehouse name in the configuration if your account is using a different warehouse.\nCreate a role\nand then\ngrant the role to the user\nfor the updated warehouse.\nMissing access to non-system databases or schemas\nThe configured user doesn't have usage grants to any database or schema.\nor",
    "metadata": {
      "source_url": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.html",
      "source_type": "docs",
      "file": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.json",
      "chunk_id": 2
    }
  },
  {
    "content": "and then\ngrant the role to the user\nfor the updated warehouse.\nMissing access to non-system databases or schemas\nThe configured user doesn't have usage grants to any database or schema.\nor\nThe configured user doesn't have usage grants to any non-system database or schema.\nThis pertains to the information schema method of fetching metadata. Ensure that the user has authorized access to the databases and schemas to be crawled.\nGrant the requisite permissions as outlined\nhere\n.\nWhy are some assets from a database or schema missing?\nâ\nCheck the grants on the role attached to the user defined for the crawler. Ensure the missing database or schema is present in these grants.\nSHOW\nGRANTS\nTO\nROLE atlan_user_role\n;\nWhy are new tables or views missing?\nâ\nWhen using incremental extraction, consider running a one-time full extraction to capture any newly introduced metadata.\nMake sure the role attached to the user defined for the crawler has grants for future tables and views being created in the database:\nGRANT\nUSAGE\nON\nFUTURE SCHEMAS\nIN\nDATABASE\n\"<database-name>\"\nTO\nROLE atlan_user_role\n;\nGRANT\nREFERENCES\nON\nFUTURE\nTABLES\nIN\nDATABASE\n\"<database-name>\"\nTO\nROLE atlan_user_role\n;\nGRANT",
    "metadata": {
      "source_url": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.html",
      "source_type": "docs",
      "file": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.json",
      "chunk_id": 3
    }
  },
  {
    "content": "GRANT\nUSAGE\nON\nFUTURE SCHEMAS\nIN\nDATABASE\n\"<database-name>\"\nTO\nROLE atlan_user_role\n;\nGRANT\nREFERENCES\nON\nFUTURE\nTABLES\nIN\nDATABASE\n\"<database-name>\"\nTO\nROLE atlan_user_role\n;\nGRANT\nREFERENCES\nON\nFUTURE VIEWS\nIN\nDATABASE\n\"<database-name>\"\nTO\nROLE atlan_user_role\n;\nGRANT\nREFERENCES\nON\nFUTURE EXTERNAL\nTABLES\nIN\nDATABASE\n\"<database-name>\"\nTO\nROLE atlan_user_role\n;\nMake sure you run the below commands as well so that new tables and views you've created in-between are also visible to the user:\nGRANT\nUSAGE\nON\nALL\nSCHEMAS\nIN\nDATABASE\n\"<database-name>\"\nTO\nrole atlan_user_role\n;\nGRANT\nREFERENCES\nON\nALL\nTABLES\nIN\nDATABASE\n\"<database-name>\"\nTO\nrole atlan_user_role\n;\nGRANT\nREFERENCES\nON\nALL\nEXTERNAL\nTABLES\nIN\nDATABASE\n\"<database-name>\"\nTO\natlan_user_role\n;\nGRANT\nREFERENCES\nON\nALL\nVIEWS\nIN\nDATABASE\n\"<database-name>\"\nTO\nrole atlan_user_role\n;\nWhy is some lineage missing?\nâ\nThe query miner only mines query history for up to the previous two weeks. The miner will not mine any queries that ran before that time window. If the queries that created your assets ran before that time window, lineage for those assets will not be present.",
    "metadata": {
      "source_url": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.html",
      "source_type": "docs",
      "file": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.json",
      "chunk_id": 4
    }
  },
  {
    "content": "To mine more than the previous two weeks of query history, either use\nS3-based query mining\nor\ncontact Atlan support\n. Note that Snowflake itself only retains query history for so long as well, though. Once Snowflake itself no longer contains the query history we will be unable to mine it for lineage.\nLineage is unsupported for parameterized queries. Snowflake currently\ndoes not resolve values\nfor parameterized queries before logging them in query history. This limits Atlan from generating lineage in such cases.\nMissing attributes and lineage\nâ\nWhen using the account usage extraction method, there are currently some limitations. We are working with Snowflake to find workarounds for crawling the following:\nExternal table location data\nProcedures\nPrimary key designation\nFurthermore, only database-level filtering is currently possible.\nWhat views does Atlan require access to for the account usage method?\nâ\nWhen using the\naccount usage method\nfor fetching metadata, Atlan requires access to the following views in Snowflake:\nFor the crawler:\nDATABASES\n,\nSCHEMATA\n,\nTABLES\n,\nVIEWS\n,\nCOLUMNS\n, and\nPIPES\nFor the miner and\npopularity metrics\n:\nQUERY_HISTORY\n,\nACCESS_HISTORY\n, and",
    "metadata": {
      "source_url": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.html",
      "source_type": "docs",
      "file": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.json",
      "chunk_id": 5
    }
  },
  {
    "content": "For the crawler:\nDATABASES\n,\nSCHEMATA\n,\nTABLES\n,\nVIEWS\n,\nCOLUMNS\n, and\nPIPES\nFor the miner and\npopularity metrics\n:\nQUERY_HISTORY\n,\nACCESS_HISTORY\n, and\nSESSIONS\nWhy am I getting a destination URL mismatch error when authenticating via Okta SSO?\nâ\nThis error can occur when you're connecting to Snowflake through\nOkta SSO\nand enter the URL of your Snowflake instance in a format different from the one used in Okta.\nSnowflake follows two URL formats:\nLegacy format   - Â\n<AccountLocator>.<Region>.snowflakecomputing.com\nor\n<AccountLocator>.<Region>.<cloud>.snowflakecomputing.com\nNew URL format   -\n<Orgname>-<AccountName>.snowflakecomputing.com\nEnsure that you're using the same Snowflake URL format in Snowflake and Okta. Refer to\nSnowflake documentation\nto learn more.\nWhy am I getting a 'name or service not known' error when connecting via private link?\nâ\nIf you're getting the following error messages   -\njava.net.UnknownHostException\nand\nName or service not known\n-  this is a known error for users who have upgraded to the Snowflake JDBC driver version 3.13.25., have underscores in their account name, and connect to their Snowflake accounts over\nprivate link\n(for example,",
    "metadata": {
      "source_url": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.html",
      "source_type": "docs",
      "file": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.json",
      "chunk_id": 6
    }
  },
  {
    "content": "private link\n(for example,\nhttps://my_account.us-west-2.privatelink.snowflakecomputing.com\n).\nIf your Snowflake account name has an underscore   -  for example,\nmy_account\n- Â the updated JDBC driver will automatically convert underscores to dashes or hyphens\n-\n. This does not affect normal URLs because Snowflake accepts URLs with both hyphens and underscores.\nFor private link users, however, the JDBC driver will return an error if there are underscores present in the account name and the connection will fail. To troubleshoot further, refer to\nSnowflake documentation\n.",
    "metadata": {
      "source_url": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.html",
      "source_type": "docs",
      "file": "apps_connectors_data-warehouses_snowflake_troubleshooting_troubleshooting-snowflake-connectivity.json",
      "chunk_id": 7
    }
  }
]