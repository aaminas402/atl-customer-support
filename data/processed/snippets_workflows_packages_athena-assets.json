{
  "source_url": "snippets_workflows_packages_athena-assets.html",
  "text": "Athena assets package - Developer\nSkip to content\nAthena assets package\nÂ¶\nThe\nAthena assets package\ncrawls Athena assets and publishes them to Atlan for discovery.\nDirect extraction\nÂ¶\nWill create a new connection\nThis should only be used to create the workflow the first time. Each time you run this method it will create a new connection and new assets within that connection â€” which could lead to duplicate assets if you run the workflow this way multiple times with the same settings.\nInstead, when you want to re-crawl assets, re-run the existing workflow (see\nRe-run existing workflow\nbelow).\n4.0.0\nTo crawl Athena assets directly from Athena:\nJava\nPython\nKotlin\nRaw REST API\nDirect extraction from Athena\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\nWorkflow\nathena\n=\nAthenaCrawler\n.\niamUserAuth\n(\n// (1)\n\"production\"\n,\n// (2)\n\"athena.ap-south-1.amazonaws.com\"\n,\n// (3)\n443\n,\n// (4)\n\"pEBDcOauyVfCtQacdvJUL\"\n,\n// (5)\n\"eKnUIFK2JvmVO5mruqbxjnzXf\"\n,\n// (6)\n\"s3://bucket/location\"\n,\n// (7)\n\"workgroup\"\n,\n// (8)\nList\n.\nof\n(\nclient\n.\ngetRoleCache\n().\ngetIdForName\n(\n\"$admin\"\n)),\n// (8)\nnull\n,\nnull\n,\ntrue\n,\n// (9)\ntrue\n,\n// (10)\n10000L\n,\n// (11)\nMap\n.\nof\n(\n\"AwsDataCatalog\"\n,\nList\n.\nof\n(\n\"schema_one\"\n,\n\"schema_two\"\n)),\n// (12)\nnull\n);\n// (13)\nWorkflowResponse\nresponse\n=\nathena\n.\nrun\n(\nclient\n);\n// (14)\nThe\nAthenaCrawler\npackage will create a workflow to crawl assets from Athena. The\niamUserAuth()\nmethod creates a workflow for crawling assets directly from Athena using IAM-based authentication.\nYou must provide a name for the connection that the Athena assets will exist within.\nYou must provide the hostname of your Athena instance.\nYou must specify the port number of the Athena instance (use\n443\nfor the default).\nYou must provide your IAM access key for accessing Athena.\nYou must provide your IAM secret key for accessing Athena.\nYou must provide an S3 location these IAM credentials can access for storing Athena query results.\nYou must specify at least one connection admin, either:\neveryone in a role (in this example, all\n$admin\nusers)\na list of groups (names) that will be connection admins\na list of users (names) that will be connection admins\nYou can also specify whether to allow queries against these Athena assets (true) or disable all querying to these assets (false).\nYou can also specify whether to allow data in these Athena assets to be previewed (true) or not (false).\nYou can also specify the maximum number of rows you'll allow to be returned from a query against these Athena assets.\nYou can also optionally specify the list of schemas to include in crawling. For Athena assets, this should be specified as a list of schema names provided as the value in a map with the key\nAwsDataCatalog\n. (If set to null, all schemas will be crawled.)\nYou can also optionally specify the list of schemas to exclude from crawling. For Athena assets, this should be specified as a list of schema names provided as the value in a map with the key\nAwsDataCatalog\n. (If set to null, no schemas will be excluded.)\nYou can then run the workflow using the\nrun()\nmethod on the object you've created. Because this operation will execute work in Atlan, you must\nprovide it an\nAtlanClient\nthrough which to connect to the tenant.\nWorkflows run asynchronously\nRemember that workflows run asynchronously. See the\npackages and workflows introduction\nfor details on how you can check the status and wait until the workflow has been completed.\nComing soon\nDirect extraction from Athena\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\nval\nathena\n=\nAthenaCrawler\n.\niamUserAuth\n(\n// (1)\n\"production\"\n,\n// (2)\n\"athena.ap-south-1.amazonaws.com\"\n,\n// (3)\n443\n,\n// (4)\n\"pEBDcOauyVfCtQacdvJUL\"\n,\n// (5)\n\"eKnUIFK2JvmVO5mruqbxjnzXf\"\n,\n// (6)\n\"s3://bucket/location\"\n,\n// (7)\n\"workgroup\"\n,\n// (8)\nlistOf\n(\nclient\n.\nroleCache\n.\ngetIdForName\n(\n\"\\\n$\nadmin\n\"\n)),\n// (8)\nnull\n,\nnull\n,\ntrue\n,\n// (9)\ntrue\n,\n// (10)\n10000L\n,\n// (11)\nmapOf\n(\n\"AwsDataCatalog\"\nto\nlistOf\n(\n\"schema_one\"\n,\n\"schema_two\"\n)),\n// (12)\nnull\n);\n// (13)\nWorkflowResponse\nresponse\n=\nathena\n.\nrun\n(\nclient\n);\n// (14)\nThe\nAthenaCrawler\npackage will create a workflow to crawl assets from Athena. The\niamUserAuth()\nmethod creates a workflow for crawling assets directly from Athena using IAM-based authentication.\nYou must provide a name for the connection that the Athena assets will exist within.\nYou must provide the hostname of your Athena instance.\nYou must specify the port number of the Athena instance (use\n443\nfor the default).\nYou must provide your IAM access key for accessing Athena.\nYou must provide your IAM secret key for accessing Athena.\nYou must provide an S3 location these IAM credentials can access for storing Athena query results.\nYou must specify at least one connection admin, either:\neveryone in a role (in this example, all\n$admin\nusers)\na list of groups (names) that will be connection admins\na list of users (names) that will be connection admins\nYou can also specify whether to allow queries against these Athena assets (true) or disable all querying to these assets (false).\nYou can also specify whether to allow data in these Athena assets to be previewed (true) or not (false).\nYou can also specify the maximum number of rows you'll allow to be returned from a query against these Athena assets.\nYou can also optionally specify the list of schemas to include in crawling. For Athena assets, this should be specified as a list of schema names provided as the value in a map with the key\nAwsDataCatalog\n. (If set to null, all schemas will be crawled.)\nYou can also optionally specify the list of schemas to exclude from crawling. For Athena assets, this should be specified as a list of schema names provided as the value in a map with the key\nAwsDataCatalog\n. (If set to null, no schemas will be excluded.)\nYou can then run the workflow using the\nrun()\nmethod on the object you've created. Because this operation will execute work in Atlan, you must\nprovide it an\nAtlanClient\nthrough which to connect to the tenant.\nWorkflows run asynchronously\nRemember that workflows run asynchronously. See the\npackages and workflows introduction\nfor details on how you can check the status and wait until the workflow has been completed.\nCreate the workflow via UI only\nWe recommend creating the workflow only via the UI. To rerun an existing workflow, see the steps below.\nRe-run existing workflow\nÂ¶\n4.0.0\nTo re-run an existing workflow for Athena assets:\nJava\nPython\nKotlin\nRaw REST API\nRe-run existing Athena workflow\n1\n2\n3\n4\nList\n<\nWorkflowSearchResult\n>\nexisting\n=\nWorkflowSearchRequest\n// (1)\n.\nfindByType\n(\nclient\n,\nAthenaCrawler\n.\nPREFIX\n,\n5\n);\n// (2)\n// Determine which of the results is the Athena workflow you want to re-run...\nWorkflowRunResponse\nresponse\n=\nexisting\n.\nget\n(\nn\n).\nrerun\n(\nclient\n);\n// (3)\nYou can search for existing workflows through the\nWorkflowSearchRequest\nclass.\nYou can find workflows by their type using the\nfindByType()\nhelper method and providing the prefix for one of the packages. In this example, we do so for the\nAthenaCrawler\n. (You can also specify the maximum number of resulting workflows you want to retrieve as results.)\nOnce you've found the workflow you want to re-run, you can simply call the\nrerun()\nhelper method on the workflow search result. The\nWorkflowRunResponse\nis just a subtype of\nWorkflowResponse\nso has the same helper method to monitor progress of the workflow run. Because this operation will execute work in Atlan, you must\nprovide it an\nAtlanClient\nthrough which to connect to the tenant.\nOptionally, you can use the\nrerun(client, true)\nmethod with idempotency to avoid re-running a workflow that is already in running or in a pending state. This will return details of the already running workflow if found, and by default, it is set to\nfalse\nWorkflows run asynchronously\nRemember that workflows run asynchronously. See the\npackages and workflows introduction\nfor details on how you can check the status and wait until the workflow has been completed.\nComing soon\nRe-run existing Athena workflow\n1\n2\n3\n4\nval\nexisting\n=\nWorkflowSearchRequest\n// (1)\n.\nfindByType\n(\nclient\n,\nAthenaCrawler\n.\nPREFIX\n,\n5\n)\n// (2)\n// Determine which of the results is the Athena workflow you want to re-run...\nval\nresponse\n=\nexisting\n.\nget\n(\nn\n).\nrerun\n(\nclient\n)\n// (3)\nYou can search for existing workflows through the\nWorkflowSearchRequest\nclass.\nYou can find workflows by their type using the\nfindByType()\nhelper method and providing the prefix for one of the packages. In this example, we do so for the\nAthenaCrawler\n. (You can also specify the maximum number of resulting workflows you want to retrieve as results.)\nOnce you've found the workflow you want to re-run, you can simply call the\nrerun()\nhelper method on the workflow search result. The\nWorkflowRunResponse\nis just a subtype of\nWorkflowResponse\nso has the same helper method to monitor progress of the workflow run. Because this operation will execute work in Atlan, you must\nprovide it an\nAtlanClient\nthrough which to connect to the tenant.\nOptionally, you can use the\nrerun(client, true)\nmethod with idempotency to avoid re-running a workflow that is already in running or in a pending state. This will return details of the already running workflow if found, and by default, it is set to\nfalse\nWorkflows run asynchronously\nRemember that workflows run asynchronously. See the\npackages and workflows introduction\nfor details on how you can check the status and wait until the workflow has been completed.\nRequires multiple steps through the raw REST API\nFind the existing workflow.\nSend through the resulting re-run request.\nPOST /api/service/workflows/indexsearch\n1\n2\n3\n4\n5\n6\n7\n8\n9\n10\n11\n12\n13\n14\n15\n16\n17\n18\n19\n20\n21\n22\n23\n24\n25\n26\n27\n28\n29\n30\n31\n32\n33\n{\n\"from\"\n:\n0\n,\n\"size\"\n:\n5\n,\n\"query\"\n:\n{\n\"bool\"\n:\n{\n\"filter\"\n:\n[\n{\n\"nested\"\n:\n{\n\"path\"\n:\n\"metadata\"\n,\n\"query\"\n:\n{\n\"prefix\"\n:\n{\n\"metadata.name.keyword\"\n:\n{\n\"value\"\n:\n\"atlan-athena\"\n// (1)\n}\n}\n}\n}\n}\n]\n}\n},\n\"sort\"\n:\n[\n{\n\"metadata.creationTimestamp\"\n:\n{\n\"nested\"\n:\n{\n\"path\"\n:\n\"metadata\"\n},\n\"order\"\n:\n\"desc\"\n}\n}\n],\n\"track_total_hits\"\n:\ntrue\n}\nSearching by the\natlan-athena\nprefix will ensure you only find existing Athena assets workflows.\nName of the workflow\nThe name of the workflow will be nested within the\n_source.metadata.name\nproperty of the response object. (Remember since this is a search, there could be multiple results, so you may want to use the other details in each result to determine which workflow you really want.)\nPOST /api/service/workflows/submit\n100\n101\n102\n103\n104\n{\n\"namespace\"\n:\n\"default\"\n,\n\"resourceKind\"\n:\n\"WorkflowTemplate\"\n,\n\"resourceName\"\n:\n\"atlan-athena-1684500411\"\n// (1)\n}\nSend the name of the workflow as the\nresourceName\nto rerun it.\n2022-12-28\n2025-01-16\nWas this page helpful?\nThanks for your feedback!\nThanks for your feedback! Help us improve this page by using our\nfeedback form\nto provide us with more information.\nBack to top\nCookie consent\nWe use cookies to:\nAnonymously measure page views, and\nAllow you to give us one-click feedback on any page.\nWe do\nnot\ncollect or store:\nAny personally identifiable information.\nAny information for any (re)marketing purposes.\nWith your consent, you're helping us to make our documentation better ðŸ’™\nGoogle Analytics\nAccept\nReject\nManage settings",
  "source_type": "sdk"
}